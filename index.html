<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>ä¸‰å­—ç»</title>
  <style>
    body { font-family: "Microsoft YaHei", sans-serif; background: #f8f9fa; padding: 20px; }
    .container { max-width: 700px; margin: auto; background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    textarea { width: 100%; height: 100px; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; }
    .btns { text-align: center; margin: 15px 0; }
    button { padding: 8px 20px; margin: 0 10px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
    .encrypt { background: #3b82f6; color: white; }
    .decrypt { background: #10b981; color: white; }
  </style>
</head>
<body>
  <div class="container">
    <h2>ä¸‰å­—ç»</h2>

    <textarea id="top" placeholder="åœ¨æ­¤è¾“å…¥æˆ–ç²˜è´´..."></textarea>

    <div class="btns">
      <button class="encrypt" onclick="encrypt()">ğŸ”’ åŠ å¯†</button>
      <button class="decrypt" onclick="decrypt()">ğŸ”“ è§£å¯†</button>
    </div>

    <textarea id="bottom" placeholder="ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..." readonly></textarea>
  </div>

  <script>
    // âœ… 64 æ¡ä¸¥æ ¼æ— é‡å¤ä¸‰å­—å¥ï¼ˆå·²å»é‡ï¼ï¼‰
    const phrases = [
      'äººä¹‹åˆ', 'æ€§æœ¬å–„', 'æ€§ç›¸è¿‘', 'ä¹ ç›¸è¿œ', 'è‹Ÿä¸æ•™', 'æ€§ä¹ƒè¿', 'æ•™ä¹‹é“', 'è´µä»¥ä¸“',
      'æ˜”å­Ÿæ¯', 'æ‹©é‚»å¤„', 'æ–­æœºæ¼', 'çª¦ç‡•å±±', 'æœ‰ä¹‰æ–¹', 'æ•™äº”å­', 'åä¿±æ‰¬', 'çˆ¶ä¹‹è¿‡',
      'å¸ˆä¹‹æƒ°', 'éæ‰€å®œ', 'è€ä½•ä¸º', 'ä¸æˆå™¨', 'ä¸çŸ¥ä¹‰', 'æ–¹å°‘æ—¶', 'äº²å¸ˆå‹', 'ä¹ ç¤¼ä»ª',
      'é¦™ä¹é¾„', 'èƒ½æ¸©å¸­', 'æ‰€å½“æ‰§', 'èå››å²', 'èƒ½è®©æ¢¨', 'å¼Ÿäºé•¿', 'å®œå…ˆçŸ¥', 'é¦–å­æ‚Œ',
      'æ¬¡è§é—»', 'çŸ¥æŸæ•°', 'è¯†æŸæ–‡', 'ä¸€è€Œå', 'åè€Œç™¾', 'ç™¾è€Œåƒ', 'åƒè€Œä¸‡', 'ä¸‰æ‰è€…',
      'å¤©åœ°äºº', 'ä¸‰å…‰è€…', 'æ—¥æœˆæ˜Ÿ', 'ä¸‰çº²è€…', 'å›è‡£ä¹‰', 'çˆ¶å­äº²', 'å¤«å¦‡é¡º', 'æ›°æ˜¥å¤',
      'æ›°ç§‹å†¬', 'æ­¤å››æ—¶', 'è¿ä¸ç©·', 'æ›°å—åŒ—', 'æ›°è¥¿ä¸œ', 'æ­¤å››æ–¹', 'åº”ä¹ä¸­', 'å…»ä¸æ•™',
      'æ•™ä¸ä¸¥', 'ç‰ä¸ç¢', 'ä¸ºäººå­', 'å¹¼ä¸å­¦', 'å­ä¸å­¦', 'æ°‘ä¸ºè´µ', 'ç¤¾ç¨·æ¬¡', 'å›ä¸ºè½»'
    ];

    // éªŒè¯æ— é‡å¤
    if (new Set(phrases).size !== 64) {
      alert("é”™è¯¯ï¼šæ ¼è¨€æœ‰é‡å¤ï¼");
    }

    // å°†å­—ç¬¦ä¸²è½¬ä¸º UTF-8 å­—èŠ‚æ•°ç»„
    function stringToBytes(str) {
      const utf8 = new TextEncoder().encode(str);
      return Array.from(utf8);
    }

    // å°†å­—èŠ‚æ•°ç»„è½¬ä¸º 64 è¿›åˆ¶ç´¢å¼•æ•°ç»„
    function bytesToBase64Indices(bytes) {
      if (bytes.length === 0) return [];
      let indices = [];
      let value = 0;
      let bits = 0;

      for (let byte of bytes) {
        value = (value << 8) | byte;
        bits += 8;
        while (bits >= 6) {
          bits -= 6;
          indices.push((value >> bits) & 63);
        }
      }
      if (bits > 0) {
        indices.push((value << (6 - bits)) & 63);
      }
      return indices;
    }

    // å°† 64 è¿›åˆ¶ç´¢å¼•æ•°ç»„è½¬å›å­—èŠ‚æ•°ç»„
    function base64IndicesToBytes(indices) {
      let bytes = [];
      let value = 0;
      let bits = 0;

      for (let idx of indices) {
        value = (value << 6) | idx;
        bits += 6;
        while (bits >= 8) {
          bits -= 8;
          bytes.push((value >> bits) & 255);
        }
      }
      // å¿½ç•¥æœ€åä¸è¶³ 8 ä½çš„å¡«å……
      return bytes;
    }

    // å°†å­—èŠ‚æ•°ç»„è½¬ä¸ºå­—ç¬¦ä¸²
    function bytesToString(bytes) {
      const uint8 = new Uint8Array(bytes);
      return new TextDecoder().decode(uint8);
    }

    function encrypt() {
      const input = document.getElementById('top').value;
      if (!input) { alert('è¯·è¾“å…¥å†…å®¹'); return; }

      try {
        const bytes = stringToBytes(input);
        const indices = bytesToBase64Indices(bytes);
        const result = indices.map(i => phrases[i]).join(' ');
        document.getElementById('bottom').value = result;
      } catch (e) {
        alert('åŠ å¯†å¤±è´¥');
      }
    }

    function decrypt() {
      const input = document.getElementById('top').value;
      if (!input) { alert('è¯·ç²˜è´´ä¸‰å­—ç»'); return; }

      const words = input.split(/\s+/).filter(w => w);
      const indices = [];

      for (let word of words) {
        const idx = phrases.indexOf(word);
        if (idx === -1) {
          alert('æ— æ•ˆç‰‡æ®µï¼š' + word);
          return;
        }
        indices.push(idx);
      }

      try {
        const bytes = base64IndicesToBytes(indices);
        const original = bytesToString(bytes);
        document.getElementById('bottom').value = original;
      } catch (e) {
        alert('è§£å¯†å¤±è´¥');
      }
    }
  </script>
</body>
</html>